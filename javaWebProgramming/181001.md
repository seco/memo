# 자바 웹 프로그래밍(2일차)



* 먼저 배워야 할 기술 Servlet/JSP

* JSP도 서블릿으로 되어있다. 앞으로 JSP는 사용을 안하게 될 것 같으니 모든 문법을 알 필요는 없다.

* EL/JSTL : 정도만 사용한다.


## 서블릿 개요

* 웹을 개발할때는 서블릿을 만드는 것

* 보통 서블릿 하나가 URL 하나를 Mapping한다.
* 서블릿과 JSP로 개발한다는 것은 불편한 일이었다. 
* 그 기술을 이용해서 프레임워크를 만들기 시작함.
* 게으름을 피우려면 자동화시켜라! 개발자는 자동화를 잘 시켜야한다!
* 프레임워크는 MVC Model2 구조가 등장!
* Struts, Struts2 이후에 Spring이 등장
* 초창기 Spring은 Struts와 같이 사용하다가 Spring MVC가 등장함
* 요즘은 Spring react가 등장(아직까지는 기업에서 많이 사용하지 않음)
* 수업의 최종 목표는 Spring MVC를 배우는 것
* Spring MVC도 내부적으로 Servlet/JSP를 사용함
* 서블릿은 서블릿의 동작 원리와 핵심 클래스를 공부해야 한다.

* 브라우저에서 Enter를 치면 접속을 하고 요청을 보내면 WAS로 요청이 보내지게 된다.
* WAS(tomcat)에는 서블릿/JSP 컨테이너가 있다. 

* 서블릿 : HttpServlet을 상속받아서 클래스를 만든다.



## 서블릿 라이프사이클(Lifecycle)

어떤 path가 어떤 서블릿이 처리해주어야하는지는 web.xml이나 어노테이션(서블릿 스펙 3.0 이상 일 때)이 처리.

deploy(배치)가 될때 WAS가 알게되는 것. 



* WAS가 서블릿을 실행.
  * 메모리에 서블릿이 있느냐! (1번 생성) 
    * 메모리에 없는 경우 : 서블릿 인스턴스를 생성(WAS에서) 이후 init() 을 생성
    * 메모리에 있는 경우 : 메모리에 있는 것을 사용!
  * 이후 service() 생성! 
    * 구현은 HTTP 메소드에 따라서 HTTP Servlet 상속
* WAS가 종료되거나 서블릿이 수정될 때 : 기존 서블릿에 destroy() 가 호출
* WAS를 종료시키는 명령어(shutdown)를 사용하여 종료할 때 destroy()가 호출!
* 안전하게 종료시키는 것을 그레이스 풀이라고 한다.



> ###### 서블릿은 어떻게 실행되는지에 대한 전체적인 과정을 설명할 수 있어야 한다.

이 과정을 Servlet Lifecycle이라고 한다.

라이프 사이클을 깊게 파고 들어야한다. 빈 라이프사이클 등등..



WAS가 종료될 때 모든 서블릿이 destroy 되어야한다.



개발자에게 막장은 배울 것이 없는 회사다. 

회사는 분위기/문화가 중요하다.



---



## 쿠키와 세션 개요



최초의 브라우저는 모자익 : 화면이 보여지는 그래피컬한 브라우저임

Next Step이라는 운영체제에서 만들어짐. 스티브잡스가 만든 회사

저렴한 워크스테이션(문서와 이미지가 같이 보여진다)



넷스케이프 브라우저가 대박남. 별명 : 모질라

브라우저 header 정보에 모질라라는 이름이 들어갈 때가 있음

넷스케이프에서 만든 대표적 기술은 쿠키

브라우저에서 사용하려고 했던 기술 쿠키

쿠키는 브라우저 쪽 기술이다.

그러다가 MS에서 IE를 등장!



넷스케이프는 개발자 집단. 자신들의 코드가 깔끔하지 못한걸 참지 못함. 새로운 서비를 만드느라 MS에 브라우저 기술 격차를 따라잡힘

사람들을 락인 시켰어야한다. 편한 기술을 업그레이드 시켜서.



회사에서 사랑받는 개발자가 되려면 비즈니스에 관심이 있어야한다.

개발을 할때에는 비즈니스를 성공시키려고 노력해야한다. 트레이드 오프가 되어야한다. 속도감있게 개발되어야할때도 있어야한다. 시야를 넓게 가져야한다. 



---

## 쿠키와 세션



쿠키는 커피 쿠폰을 생각하면 편하다.

쿠키는 헤더정보에 있다. 

1. Cookie

   Header에 쿠키를 담아서 브라우저가 보낸다.

   쿠키에는 이름, 값, 유지기간(Expire day), path, domain 

   처음 생성은 WAS가 생성해서 응답으로 보낸다.

   HTTPServletResponse 클래스에는 addCookie() 를 가지고 있다.

   쿠키는 한 도메인이 무한대로 저장할 수가 없다.

   브라우저는 틈틈이 쿠키의 시간을 확인한다. 현재시간보다 낡은 쿠키가 있다면 지워버린다.

   쿠키가 어디에 담겨오는가 Request 객체에 담겨오는 것

   HTTPServletRequest에는 쿠키를 받는 getCookies() 메서드가 있다. 

   getCookies는 배열을 리턴한다. 쿠키가 없을 땐 null이다. 

   배열이나 객체가 리턴되었을 때는 null 값인지 꼭 확인해야한다.

   API를 공부할때는 확실하게 봐야한다. 배열을 리턴하는지, Null을 리턴하는지 .. 

   request.getCookies() 모든 쿠키 정보가 들어온다. 

   쿠키를 삭제하는 방법 : 같은 이름의 쿠키를 expire를 0으로 만들어서 보냄

   JS로 쿠키를 이용할수도 있는 것. 자바스크립트로도 쿠키를 생성할 수 있음

   쿠키의 단점 : 이름과 값이 모두 문자열. 헤더의 길이의 제한이 있다. 

   중요한 정보는 암호화해서 전송해야한다.

   해커들이 쿠키를 탈취하려고 노력을 많이한다. 

2. Session

   세션은 서버쪽 기술이다.

   헬스클럽의 캐비넷을 생각하면 편합니다.

   고객(브라우저), 서버(헬스클럽)

   캐비넷을 만들고 열쇠를 고객에게 준다. 

   브라우저에서 최초로 어떤 사이트에 요청을 보내면 서버에서는 session id를 만든다. 

   id로 접근할 수 있는 HttpSession 클래스(캐비넷)의 인스턴스를 생성한다. HttpSession은 이름과 값(Object)를 저장할 수 있다.

   일종의 Map 같은 객체라고 보면 된다. 이름(key), 값(Object)

   응답이 갈 때 쿠키에 session id를 담아서 보낸다.

   두 번째 요청을 보낼때는 쿠키에 세션 아이디를 담아서 보낸다. 

   세션의 장점 : Object가 저장될 수 있다. 메모리 용량만큼 저장할 수 있다. 다양하고 많은 값을 저장할 수 있다. 

   많은 해커들이 session id를 탈취하려고 노력한다. 

   PC방에서 브라우저를 사용할 때는 시크릿 모드를 이용해야 한다.

   HTTPSession은 인터페이스이다. 구현체가 따로 있다. 

   HTTPSession을 사용하려면 session id가 필요하다. 

   HTTPServletRequest는 getSession을 가지고 있다. getSession은 열쇠를 만드는 기능이 있을 수 있다.

   HTTPSession은 기본적으로 메모리에 저장한다. 

   HTTPSession의 핵심 메소드는 SetAttribute() : Key문자열, Value Attribute, getAttribute() : key 문자열, Value Object

   **쿠키와 세션은 꼭 설명할 수 있어야 한다.** 암기해서 즉각 즉각 나와야한다.

   세션 정보를 지우는 것 : removeAttibute()특정 정보만 삭제, invalidate() 모든 정보 삭제

   객체 생성 과정이 복잡하면 그 과정을 숨기는 것이 중요

   객체 생성 과정을 숨기는 것도 알아야 하는 내용이다.

   실제 사용은 API 정보를 보면서 사용

   내부적인 동작 원리는 사용법을 먼저 익히고 내부 원리를 이해해야한다.

   세션 정보는 메모리에 저장된다. 

   라운드로빈 방식으로 저장될 땐 세션 정보를 공유할 필요가 있다. 세션 인터페이스 정보를 DB에 저장한다면 세션 정보를 공유할 수 있다. 



   Spring에서는 Spring 세션이라는 것이 있다. 스프링 세션을 이해하려면 서블릿 세션 클래스를 이해해야한다.


## JSP의 동작 원리



MS의 ASP라는 기술이 있었다. ASP : 스크립트 언어

서블릿에서는 요청 페이지를 만들때마다 클래스를 새롭게 만들어야하는 불편함이 있었다. 

MS에서 만든 ASP(HTML + VB)를 사용해서 웹 페이지를 보여주는 방식이 조금 더 편해서 그것을 참고하여 JSP를 만듦.

JSP : 스크립트 언어. HTML + JAVA가 섞여있다. 

hello.jsp

```jsp
<H1>
    Hello
</H1>
<% (이 부분을 스크립틀릿이라고 한다.)
	JAVA 코드.
        여기서 사용되는 객체를 내장 객체라고 한다. (out, response, session, out 등이 있다)
%>
```



맨 처음 JSP를 만들면 자바 소스로 바뀌고 컴파일 된 후 서블릿으로 바뀐다.

내장 객체 request, response, session, out ...

JSP 안에서 생성된 자바 소스 <% .. %> (스크립틀릿이라고 부른다)는 service() 메서드 안으로 들어간다.



JSP에 자바 코드가 빠지면 동적인게 아닌게 된다. 

왜 자바코드를 쓰지 말라고 할까? - 유지보수할때 어렵기 때문에 

JSP -> Object -> DB 호환되는 것이 MVC Model 1이라고 한다. JSP 초창기 모델

URL 하나당 서블릿 클래스가 하나 만들어져야 한다. 이것이 복잡하고 번거롭기 때문에 개선된 버전이 나온 것.

이것은 객체지향의 응집력과는 좀 다르다.

Front Controller라는 서블릿 클래스 생성 : 모든 요청을 받는 클래스 /*

예를 들어 게시판과 관련된 메서드를 모아놓은 것을 Controller라고 한다.

결과를 출력할 떄 JSTL, EL을 사용한다. 퍼블리셔가 사용하기 편한 상태다. 결과만 출력한다. 



프레임워크가 Front Controller를 만들어준다. 개발자는 Controller만 만들면 된다.

Front Controller-Controller 구조를 MVC Model 2라고 한다.

Model2 구조를 설명하시오! 하면 그림부터 그린다.

공부할때 알아둘 것 : 내가 공부하기 어려운 것은 좋은 기술(사람들이 많이 쓴다는 가정하에)



오늘은 서블릿/jsp 동작 원리

mvc model1, 2 에대해서 배웠다. 

내일은 실습을 해볼 것!

오늘 배운 내용은 짧게 설명할 수 있어야한다.