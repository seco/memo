# Spring mvc 파일 저장



- 옛날에는 터미널에서 이메일을 주고 받았다. 유즈넷
- 유즈넷에서 원래는 텍스트만 공유했는데 파일을 주고 받고 싶어졌다. zip 파일을 바이너리 파일로 쪼개어 나누어 저장하고 text로 전송하여 업로드 함. (멀티파트의 초기버전)
- 이메일도 멀티파트를 사용
- HTTP 프로토콜이 등장하면서 body에 멀티파트 형식으로 파일을 전송.
- 아파치 자카르타 프로젝트 (자바관련)에서 파일 업로드 관련 라이브러리를 개발
- 파일 업로드 관련 라이브러리도 pom.xml에 등록해줘야함.
- 멀티파트파일 : 파일을 가지고 있는 애가 아니고 읽어들일 수 있는 스트림을 가지고 있다.
- 한번에 받아와서 메모리에 올라가면 서버에 부하가 심해진다.
- 멀티파트파일에서 타입을 제공해준다.
- 멀티파트파일을 쓰기 위해서는 스프링에서 어떤 설정을 해주어야하는가?!
- 멀티파트파일에서 읽어들여서 쓸때는 어떻게 써야하는가?! - 디렉터리 구조를 가져야한다, 외부에서 접근하면 안된다. 파일이 저장되는 경로는 웹어플리케이션과 상관없는 경로여야한다. 한 폴더에 너무 많은 파일이 저장되면 안된다. (년/월/일/파일이름) 실제 저장될 파일 명, 파일의 용량, 컨텐츠 타입 등이 DB에 저장되어있어야한다.
- 업로드가 되었으면 다운로드 할 수 있는 프로그램도 만들어야한다. 접근하는 컨트롤러를 만들어서 다운로드 받을 수 있게 해야한다. HTTP 프로토콜 바디에 출력해줘야한다.
- resp.getOutputStream(); 
- 콘트롤러에서 다운로드를 하면 view가 없어야한다. 이에관한 에노테이션은 @ResponseBody
- Controller가 보통 String을 리턴했다. 다운로드는 리턴타입이 void가 되어야한다.

- 업로드를 하려면 멀티파트로 전송(폼 테그에서 enc라는 설정을 해주어야함) 멀티파트 리졸버 pom.xml에서 저장.
- @RequsetBody : 리퀘스트의 바디에 정보를 읽어들일 때. 

* 멀티파트 리졸버 : Multipart 객체를 컨트롤러에 전달하는 역할.

* 파일 업로드는 디렉토리에 저장
* 클라우드로 업로드 할 경우 서버에 올리는 경우와는 조금 다르다. 클라우드 시스템에 파일 업로드가 안된다. 
* S3 : 파일 스토리지 시스템.
* 프로파일 : 환경에 따라서 다른 빈을 사용하게 해주는 것(스프링에서 제공)



* 폼에서 이름이 같으면 배열로 넘어온다는 것.
* 컨트롤러 메소드에서 파라미터로 HttpSession하면 된다. 



---

https://www.journaldev.com/2573/spring-mvc-file-upload-example-single-multiple-files 의 내용을 정리



설정 파일

- pom.xml

```xml
<!-- Apache Commons FileUpload --> 
<dependency>
	<groupId>commons-fileupload</groupId>
	<artifactId>commons-fileupload</artifactId>
	<version>1.3.1</version>
</dependency>

<!-- Apache Commons IO --> 
<dependency>
	<groupId>commons-io</groupId>
	<artifactId>commons-io</artifactId>
	<version>2.4</version>
</dependency>
```



- jsp(View)

```jsp
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page session="false" %>
<html>
<head>
<title>Upload File Request Page</title>
</head>
<body>
	<form method="POST" action="uploadFile" enctype="multipart/form-data">
		File to upload: <input type="file" name="file"><br /> 
		Name: <input type="text" name="name"><br /> <br /> 
		<input type="submit" value="Upload"> Press here to upload the file!
	</form>	
</body>
</html>
```



- 배열을 전달할 경우(대용량 파일 전송)

```jsp
<%@ taglib uri="http://java.sun.com/jsp/jstl/core" prefix="c" %>
<%@ page session="false" %>
<html>
<head>
<title>Upload Multiple File Request Page</title>
</head>
<body>
	<form method="POST" action="uploadMultipleFile" enctype="multipart/form-data">
		File1 to upload: <input type="file" name="file"><br /> 
		Name1: <input type="text" name="name"><br /> <br /> 
		File2 to upload: <input type="file" name="file"><br /> 
		Name2: <input type="text" name="name"><br /> <br />
		<input type="submit" value="Upload"> Press here to upload the file!
	</form>
</body>
</html>
```



* 설정파일 추가 (WebMvcContenxtConfigure.java)

```java
    @Bean
    public CommonsMultipartResolver multipartResolver() {
        CommonsMultipartResolver resolver=new CommonsMultipartResolver();
        resolver.setDefaultEncoding("utf-8");
        return resolver;
    }
```



